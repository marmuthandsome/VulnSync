import os
from styles import RESET, BOLD, LCYAN, RED, LPURPLE, GREEN

def check_and_display_vulnerability(vulnerability_name, grep_pattern, severity, description, recommendation, owasp_standard_2021, filename):
    vulnerabilities_found = False
    hosts = f"grep -q -o -h '{grep_pattern}' {filename}"
    if os.system(hosts) == 0:
        vulnerabilities_found = True
        print(f"{RED}Vulnerability{RESET}: {vulnerability_name}")
        print(f"{RED}Severity{RESET}: {severity}")
        print(f"{RED}Impact{RESET}: {description}")
        print(f"{LCYAN}OWASP 2021 Standard{RESET}: {owasp_standard_2021}")
        print("")
        print(f"{LPURPLE}Recommendation{RESET}: {recommendation}")
        print("")
        print("+++=======================================================+++")
        print("")
    return vulnerabilities_found

def check_and_display_vulnerabilities(filename):
    vulnerabilities_found = False

    def _check_and_display(vulnerability_name, grep_pattern, severity, description, recommendation, owasp_standard_2021):
        nonlocal vulnerabilities_found
        if check_and_display_vulnerability(vulnerability_name, grep_pattern, severity, description, recommendation, owasp_standard_2021, filename):
            vulnerabilities_found = True

    _check_and_display(
            "SSH Authentication Methods Enumeration",
            "ssh-auth-methods",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N (6.5 Medium)",
            "\nSecurity Risk: Enumerating SSH authentication methods can reveal potentially insecure methods, which could be targeted by attackers.",
            "\nDisable Weak Methods: Disable deprecated and weak authentication methods (e.g., password-based authentication and publickey-based authentication) in favor of more secure methods such as public key-based authentication.",
            "OWASP A5:2021 - Security Misconfiguration"
        )

    _check_and_display(
            "Weak SSH Enumeration Algorithms",
            "3des-cbc\|arcfour\|rc4",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nSecurity Risk: The use of weak SSH enumeration algorithms such as 3des-cbc, arcfour, and rc4 poses a significant security risk. These algorithms have known vulnerabilities and weaknesses that can be exploited by attackers to compromise the confidentiality and integrity of SSH communications.",
            "\nUpdate SSH Configuration: It is strongly recommended to update the SSH server configuration to disallow the use of weak encryption algorithms, including 3des-cbc, arcfour, and rc4.",
            "OWASP A2:2021 - Cryptographic Failures"
        )

    _check_and_display(
            "Insecure SSH Authentication Methods",
            "publickey",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nDiscovered that the SSH server supports both the 'publickey' and 'password' authentication methods, potentially exposing the system to security risks.",
            "\nThis configuration exposes the system to the risk of brute force attacks, where attackers may attempt to gain unauthorized access using weak passwords or by exploiting vulnerabilities in the public key authentication process.",
            "OWASP A7:2021 - Identification and Authentication Failures"
        )

    _check_and_display(
            "Anonymous FTP login allowed",
            "Anonymous FTP login allowed",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N (5.4 Medium)",
            "\nSecurity Risk: Allowing anonymous FTP login can pose a significant security risk. It means that anyone can access and potentially upload or download files from your FTP server without authentication. This could lead to unauthorized access, data breaches, or the uploading of malicious files.",
            "\nDisable Anonymous FTP: The most effective way to mitigate this risk is to disable anonymous FTP login altogether. This can usually be done in your FTP server's configuration. By doing so, you ensure that only authorized users can access the FTP server.",
            "OWASP A5:2021 - Security Misconfiguration"
        )

    _check_and_display(
            "Telnet Server Without Encryption Support",
            "Telnet server does not support encryption",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nSecurity Risk: Telnet is inherently insecure as it transmits data, including login credentials, in plain text. Without encryption support, sensitive information is vulnerable to eavesdropping by malicious actors.",
            "\nImplement Secure Alternatives: Replace Telnet with more secure alternatives such as SSH (Secure Shell), which encrypts communication and provides stronger security. | Disable Telnet: If possible, disable the Telnet service on the server to eliminate the security risk associated with plaintext communication.",
            "OWASP A2:2021 - Cryptographic Failures"
        )

    _check_and_display(
            "Telnet Use Detected, Recommended to Switch to FTP or SSH",
            "telnet-ntlm-info",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nSecurity Risk: The use of Telnet exposes sensitive information, including login credentials, to eavesdropping by attackers.",
            "\nImplement Secure Alternatives: Install and configure SSH (port 22) or FTPS (for secure FTP with TLS/SSL) as the replacement protocol for secure communication. Ensure that SSH is properly configured with key-based authentication rather than password-based authentication.",
            "OWASP A2:2021 - Cryptographic Failures"
        )

    _check_and_display(
            "HSTS not configured in HTTPS Server",
            "HSTS not configured in HTTPS Server",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nImproved Security: Enabling HSTS significantly enhances the security of your website by ensuring that all communications are encrypted using HTTPS. It mitigates risks associated with SSL-stripping attacks and prevents downgrade attacks.",
            "\nConfigure your web server to send the HSTS header in the HTTP response.\n| Strict-Transport-Security: max-age=31536000; includeSubDomains",
            "OWASP A5:2021 - Security Misconfiguration"
        )

    _check_and_display(
            "Potentially risky methods: TRACE or DELETE",
            "TRACE\|DELETE",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nImproved Security: The primary impact of fixing this issue is improved security. Disabling TRACE and implementing other security measures can help protect your web application from certain types of attacks and vulnerabilities.",
            "\nDisable TRACE Method: The most effective way to fix this issue is to disable the TRACE method altogether on your web server. This can usually be done in the web server configuration.",
            "OWASP A5:2021 - Security Misconfiguration"
        )

    _check_and_display(
            "64-bit block cipher 3DES vulnerable to SWEET32 attack",
            "64-bit block cipher 3DES vulnerable to SWEET32 attack",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nSecurity Improvement: Replacing 3DES with a more secure cipher, like AES, will significantly enhance the security of your data transmissions. It will protect against SWEET32 attacks, which exploit vulnerabilities in ciphers with 64-bit block sizes.",
            "\nReplace 3DES: Replace the 3DES (Triple Data Encryption Standard) cipher with a more secure alternative, such as AES (Advanced Encryption Standard). AES is widely considered to be secure and is not vulnerable to SWEET32 attacks.",
            "OWASP A2:2021 - Cryptographic Failures"
        )

    _check_and_display(
            "Broken cipher RC4 is deprecated by RFC 7465",
            "Broken cipher RC4 is deprecated by RFC 7465",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nSecurity Enhancement: Disabling RC4 is essential as it is known to have serious security weaknesses. By deprecating RC4, you prevent vulnerabilities like the BEAST attack and other cryptographic attacks.",
            "\nDisable RC4: Immediately disable the RC4 cipher suite in your SSL/TLS configurations. This should be done both on the server and client sides.",
            "OWASP A2:2021 - Cryptographic Failures"
        )

    _check_and_display(
            "TLSv1.0 or TLSv1.1 Enabled",
            "TLSv1.0\|TLSv1.1",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nSecurity Risk: TLSv1.0 and TLSv1.1 have known vulnerabilities that can be exploited by attackers to intercept and manipulate encrypted data. This poses a significant security risk to your system.",
            "\nUpgrade to TLSv1.2 or TLSv1.3: Upgrade your servers and applications to support TLSv1.2 or TLSv1.3. These versions are more secure and offer better protection against attacks.\n| Disable TLSv1.0 and TLSv1.1: Disable TLSv1.0 and TLSv1.1 on your servers and applications. Ensure that they are not used as negotiation options during the TLS handshake.",
            "OWASP A2:2021 - Cryptographic Failures"
        )

    _check_and_display(
            "Insecure Message Signing Configuration",
            "disabled",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:N (0 Informational)",
            "\nMessage signing is disabled, which is a dangerous default configuration. Without proper message signing, the application is vulnerable to data tampering and injection attacks, potentially leading to unauthorized access, data manipulation, or other security breaches.",
            "\nEnable Message Signing: Configure the application to use strong message signing mechanisms, such as HMAC (Hash-based Message Authentication Code) or digital signatures, to ensure the integrity and authenticity of transmitted data.",
            "OWASP A8:2021 - Software and Data Integrity Failures"
        )

    _check_and_display(
            "SMB remote memory corruption vulnerability",
            "corruption",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8 Critical)",
            "\nSuccessful exploitation of this vulnerability could allow an attacker to remotely corrupt memory in the SMB (Server Message Block) protocol implementation, leading to potential unauthorized access, data leakage, or denial of service.",
            "\nApply Security Updates: Regularly update and patch the affected systems to ensure that the SMB protocol implementation is up-to-date with the latest security fixes.",
            "OWASP A6:2021 - Vulnerable and Outdated Components"
        )

    _check_and_display(
            "Print Spooler Service Impersonation Vulnerability",
            "Impersonation",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8 Critical)",
            "\nThis vulnerability could result in an attacker executing arbitrary code with the privileges of the Print Spooler service, which might lead to unauthorized access, data manipulation, or further exploitation of the host system.",
            "\nApply Security Updates: Ensure the Print Spooler service and the underlying operating system are up-to-date with the latest security patches.",
            "OWASP A6:2021 - Vulnerable and Outdated Components"
        )

    _check_and_display(
            "MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption",
            "Remote\|Code\|Execution",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8 Critical)",
            "\nThis finding indicates a critical vulnerability that allows an attacker to execute arbitrary code remotely on Microsoft SMBv1 servers. Exploiting this vulnerability can lead to unauthorized access, data theft, and potential compromise of the entire system.",
            "\nApply Security Updates: Immediately apply the relevant security patch (MS17-010) provided by Microsoft to address this vulnerability.\nDisable SMBv1: Consider disabling SMBv1 on your systems to reduce the attack surface.",
            "OWASP A6:2021 - Vulnerable and Outdated Components"
        )
    
    _check_and_display(
            "Unprotected Redis Server",
            "redis-info",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (7.8 High)",
            "\nThe lack of password authentication on the Redis server poses a significant security risk. Attackers could potentially gain unauthorized access to sensitive data stored in the Redis database, manipulate data, or perform denial-of-service attacks, depending on the configuration and use case of the Redis server.",
            "\nEnable the 'requirepass' directive in the redis.conf configuration file.",
            "OWASP A5:2021 - Security Misconfiguration"
        )

    _check_and_display(
            "Insecure VNC Configuration (VNC NONE AUTH)",
            "does not require authentication",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (8.8 High)",
            "\nThe presence of VNC with the 'VNC_NONE_AUTH' authentication method indicates a serious security misconfiguration. Attackers could exploit this misconfiguration to gain unauthorized access to the system, potentially compromising sensitive data or performing malicious activities.",
            "\nDisable VNC or configure it to use secure authentication methods such as VNC password or SSH tunneling.",
            "OWASP A5:2021 - Security Misconfiguration"
        )

    _check_and_display(
            "MongoDB Database Found Without Authentication",
            "sizeOnDisk",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.4 Critical)",
            "\nThis finding indicates a severe security misconfiguration where the MongoDB database is accessible without requiring authentication. It exposes sensitive data stored in the database, allowing unauthorized access, modification, or deletion of data.",
            "\nEnable authentication mechanisms such as username/password or keyfile authentication in the MongoDB configuration.",
            "OWASP A5:2021 - Security Misconfiguration"
        )

    _check_and_display(
            "SMTP User Enumeration",
            "Users found",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N (6.5 Medium)",
            "\nThe exposure of the administrator account through SMTP user enumeration poses a significant security risk. Attackers can exploit this information to launch targeted attacks, gain unauthorized access, escalate privileges, or compromise sensitive data.",
            "\nRegularly review and update SMTP server configurations to ensure proper security controls are in place.",
            "OWASP A7:2021 - Identification and Authentication Failures"
        )

    _check_and_display(
            "Unauthorized Access via SSH Credentials Discovery",
            "\[22\]\[ssh\]",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8 Critical)",
            "\nThe discovery of SSH username and password by a pentester poses a severe security risk as it allows unauthorized access to the system, potentially leading to data breaches, unauthorized modifications, or system compromise.",
            "\nImplement strong, unique passwords for SSH accounts and avoid using default or easily guessable credentials.",
            "OWASP A7:2021 - Identification and Authentication Failures"
        )

    _check_and_display(
            "Weak Username and Password for PostgreSQL Database",
            "Login Successful",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8 Critical)",
            "\nSignificant as it poses a serious security risk to the confidentiality, integrity, and availability of the PostgreSQL database. An attacker could easily gain unauthorized access to sensitive data stored in the database, potentially leading to data breaches, unauthorized modifications, or data loss.",
            "\nImplement Strong Password Policies: Enforce the use of complex, long, and unique passwords for all database accounts, including the default postgres account.",
            "OWASP A7:2021 - Identification and Authentication Failures"
        )

    _check_and_display(
            "Mysql Hashdump",
            "Valid credentials",
            "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8 Critical)",
            "\nThe unauthorized access to hashed MySQL dumps can lead to the exposure of sensitive user information, including passwords, which can be used by attackers to gain unauthorized access to accounts, escalate privileges, or perform other malicious activities.",
            "\nEnsure that MySQL database access controls are properly configured to restrict access to authorized users only.",
            "OWASP A7:2021 - Identification and Authentication Failures"
        )
    return vulnerabilities_found#